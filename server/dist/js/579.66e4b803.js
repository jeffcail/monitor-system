"use strict";(self["webpackChunkweb"]=self["webpackChunkweb"]||[]).push([[579],{6579:function(e,a,l){l.r(a),l.d(a,{default:function(){return Z}});var t=l(6810),s=l(1870),u=l(971),r=l(366),d=l(4181),i=l(4545),n=l(7534),p=l(4195),o=l(8276),v=l(3378),_=l(6252),m=l(3577),g=l(2262),c=l(2201),w=l(842),f=l(1348),W=l(9737);const b=e=>((0,_.dD)("data-v-542384e2"),e=e(),(0,_.Cn)(),e),y={class:"addServe-info"},z=b((()=>(0,_._)("div",{class:"addServe-title",align:"left"},"添加服务检测",-1))),k=(0,_.Uk)("添加"),h={class:"serve-list"},U={style:{display:"flex","align-items":"center"}},x={style:{"margin-left":"10px"}},H={style:{display:"flex","align-items":"center"}},C={key:0,style:{"margin-left":"10px",color:"green"}},V={key:1,style:{"margin-left":"10px",color:"red"}},T=(0,_.Uk)("删除"),P={class:"demo-pagination-block"},S=b((()=>(0,_._)("div",{class:"el-upload__text"},[(0,_.Uk)(" 拖到此区域上传 或者 "),(0,_._)("em",null,"点击上传")],-1))),D=b((()=>(0,_._)("div",{class:"el-upload__tip",style:{color:"red"},align:"left"},[(0,_._)("span",null,"友情提示:"),(0,_.Uk)(),(0,_._)("br"),(0,_._)("span",null,"1. 包名必须与当前服务里start.sh 脚本中构建的名称保持一致"),(0,_.Uk)(),(0,_._)("br"),(0,_._)("span",null,"2. 包名不能带后缀"),(0,_.Uk)(),(0,_._)("br"),(0,_._)("span",null,"3. 包文件大小不能超过100M"),(0,_.Uk)(),(0,_._)("br"),(0,_._)("span",null,"4. 版本号不得重复"),(0,_.Uk)(),(0,_._)("br"),(0,_._)("span",null,"5. 当前版本号不得小于上次升级版本号")],-1))),F=(0,_.Uk)(" 输入版本号:     "),q={style:{"margin-left":"-400px"}},I=(0,_.Uk)("取消"),R=(0,_.Uk)("上传"),j=b((()=>(0,_._)("div",{style:{"marigin-top":"10px","margin-bottom":"10px"},align:"left"}," 记录 ",-1))),$={class:"demo-pagination-block"};var B={__name:"serve",setup(e){const a=(0,g.iH)(!1),l=(0,g.iH)(!1),b=(0,g.iH)(!1),B=((0,c.tv)(),(0,g.iH)(!1)),L=(0,g.iH)({go_file:"",upgrade_version:"",serve_id:0,serve_name:"",serve_address:"",serve_state:0}),Y=e=>{let a=e.file;L.value.go_file=a,Z(1)},Z=async e=>{if(1===e);else{let e=new FormData;e.append("go_file",L.value.go_file),e.append("upgrade_version",L.value.upgrade_version),e.append("serve_id",L.value.serve_id),e.append("serve_name",L.value.serve_name),e.append("serve_address",L.value.serve_address),e.append("serve_state",L.value.serve_state);let a=await(0,w.mL)(e);a&&2e3===a.code&&(f.z8.success(a.msg),B.value=!1)}},A=(0,g.iH)([]),E=(0,g.iH)(0),K=(0,g.iH)({page:1,page_size:10,serve_address:""}),M=async()=>{let e={page:K.value.page,page_size:K.value.page_size,serve_address:K.value.serve_address},a=await(0,w.RR)(e);2e3!==a.code&&(a.data=[]),A.value=a.data.list,E.value=a.data.total},G=e=>{K.value.page_size=e,K.value.page=1,M()},J=e=>{K.value.page=e,M()},N=(0,g.iH)({serve_address:"",serve_name:""}),O=(0,g.qj)({serve_address:{required:!0,message:"请输入服务地址",trigger:"blur"},serve_name:{required:!0,message:"请输入服务名称",trigger:"blur"}}),Q=(0,g.iH)(null),X=()=>{Q.value.validate((async e=>{if(e){let e={serve_name:N.value.serve_name,serve_address:N.value.serve_address},a=await(0,w.zI)(e);2e3===a.code&&(f.z8.success("添加成功"),ue())}else f.z8.warning("请填写完整")}))},ee=e=>{W.T.confirm(`确定删除${e.serve_name}吗?`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{(0,w.SH)({id:e.id});ue()})).catch((()=>{f.z8.warning("取消删除")}))},ae=(0,g.iH)(0),le=(0,g.iH)([]),te=(0,g.iH)({page:1,page_size:10}),se=(0,g.iH)(),ue=async()=>{clearTimeout(se.value),se.value=setTimeout((()=>ue()),2e4);let e={page:te.value.page,page_size:te.value.page_size},a=await(0,w.h8)(e);2e3!==a.code&&(a.data=[]),le.value=a.data.list,ae.value=a.data.total};ue();const re=e=>{te.value.page_size=e,te.value.page=1,ue()},de=e=>{te.value.page=e,ue()};return(0,_.Ah)((()=>{clearTimeout(se.value),clearTimeout(se.value)})),(e,g)=>{const c=v.EZ,w=p.nH,f=o.mi,W=p.ly,M=n.Ks,se=i.$t,ue=r.$Y,ie=(0,_.up)("timer"),ne=d.gn,pe=(0,_.up)("SuccessFilled"),oe=(0,_.up)("WarningFilled"),ve=r.eI,_e=u.R,me=(0,_.up)("upload-filled"),ge=s.LW,ce=t.d0;return(0,_.wg)(),(0,_.iD)(_.HY,null,[(0,_._)("div",null,[(0,_._)("div",y,[z,(0,_.Wm)(W,{ref_key:"ruleFormRef",ref:Q,model:N.value,rules:O,"status-icon":"","label-width":"120px",class:"demo-ruleForm"},{default:(0,_.w5)((()=>[(0,_.Wm)(w,{label:"地址",prop:"channelId"},{default:(0,_.w5)((()=>[(0,_.Wm)(c,{modelValue:N.value.serve_address,"onUpdate:modelValue":g[0]||(g[0]=e=>N.value.serve_address=e),style:{width:"500px"},type:"text",autocomplete:"off"},null,8,["modelValue"])])),_:1}),(0,_.Wm)(w,{label:"名称",prop:"url"},{default:(0,_.w5)((()=>[(0,_.Wm)(c,{modelValue:N.value.serve_name,"onUpdate:modelValue":g[1]||(g[1]=e=>N.value.serve_name=e),style:{width:"500px"},type:"text",autocomplete:"off"},null,8,["modelValue"])])),_:1}),(0,_.Wm)(w,null,{default:(0,_.w5)((()=>[(0,_.Wm)(f,{type:"primary",onClick:g[2]||(g[2]=e=>X())},{default:(0,_.w5)((()=>[k])),_:1})])),_:1})])),_:1},8,["model","rules"])])]),(0,_._)("div",h,[(0,_.Wm)(ve,{data:le.value,style:{width:"100%"}},{default:(0,_.w5)((()=>[(0,_.Wm)(ue,{label:"名称",width:"280"},{default:(0,_.w5)((e=>[(0,_.Wm)(se,{effect:"light",trigger:"hover",placement:"top",width:"auto"},{default:(0,_.w5)((()=>[(0,_._)("div",null,(0,m.zw)(e.row.serve_address),1)])),reference:(0,_.w5)((()=>[(0,_.Wm)(M,null,{default:(0,_.w5)((()=>[(0,_.Uk)((0,m.zw)(e.row.serve_name),1)])),_:2},1024)])),_:2},1024)])),_:1}),(0,_.Wm)(ue,{label:"上次检测时间",width:"280"},{default:(0,_.w5)((e=>[(0,_._)("div",U,[(0,_.Wm)(ne,null,{default:(0,_.w5)((()=>[(0,_.Wm)(ie)])),_:1}),(0,_._)("span",x,(0,m.zw)(e.row.last_check_time),1)])])),_:1}),(0,_.Wm)(ue,{label:"状态",width:"280"},{default:(0,_.w5)((e=>[(0,_._)("div",H,[1==e.row.serve_state?((0,_.wg)(),(0,_.iD)("span",C,[(0,_.Wm)(ne,null,{default:(0,_.w5)((()=>[(0,_.Wm)(pe)])),_:1})])):((0,_.wg)(),(0,_.iD)("span",V,[(0,_.Wm)(ne,null,{default:(0,_.w5)((()=>[(0,_.Wm)(oe)])),_:1})]))])])),_:1}),(0,_.Wm)(ue,{label:"操作"},{default:(0,_.w5)((({row:e})=>[(0,_.Wm)(f,{size:"small",type:"danger",onClick:a=>ee(e)},{default:(0,_.w5)((()=>[T])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"]),(0,_._)("div",P,[(0,_.Wm)(_e,{currentPage:te.value.page,"onUpdate:currentPage":g[3]||(g[3]=e=>te.value.page=e),"page-size":te.value.page_size,"onUpdate:page-size":g[4]||(g[4]=e=>te.value.page_size=e),"page-sizes":[10,20,30,40,50],small:a.value,disabled:l.value,background:b.value,layout:"total, sizes, prev, pager, next, jumper",total:ae.value,"current-page":te.value.page,onSizeChange:re,onCurrentChange:de},null,8,["currentPage","page-size","small","disabled","background","total","current-page"])]),(0,_.Wm)(ce,{modelValue:B.value,"onUpdate:modelValue":g[10]||(g[10]=e=>B.value=e),title:"升级服务",width:"40%",draggable:""},{default:(0,_.w5)((()=>[(0,_.Wm)(W,{model:L.value},{default:(0,_.w5)((()=>[(0,_.Wm)(ge,{class:"upload-demo",drag:"",multiple:"","http-request":Y,limit:1},{tip:(0,_.w5)((()=>[D])),default:(0,_.w5)((()=>[(0,_.Wm)(ne,{class:"el-icon--upload"},{default:(0,_.w5)((()=>[(0,_.Wm)(me)])),_:1}),S])),_:1}),(0,_.Wm)(w,null,{default:(0,_.w5)((()=>[F,(0,_.Wm)(c,{modelValue:L.value.upgrade_version,"onUpdate:modelValue":g[5]||(g[5]=e=>L.value.upgrade_version=e),autocomplete:"off",style:{width:"200px"}},null,8,["modelValue"])])),_:1})])),_:1},8,["model"]),(0,_._)("div",q,[(0,_.Wm)(f,{onClick:g[6]||(g[6]=e=>B.value=!1)},{default:(0,_.w5)((()=>[I])),_:1}),(0,_.Wm)(f,{type:"primary",onClick:g[7]||(g[7]=e=>Z(2))},{default:(0,_.w5)((()=>[R])),_:1})]),j,(0,_.Wm)(ve,{data:A.value,style:{width:"100%"}},{default:(0,_.w5)((()=>[(0,_.Wm)(ue,{prop:"created_at",label:"升级时间",width:"200"}),(0,_.Wm)(ue,{prop:"serve_name",label:"服务名称",width:"200"}),(0,_.Wm)(ue,{prop:"pack_name",label:"包名",width:"200"}),(0,_.Wm)(ue,{prop:"upgrade_version",label:"版本号"})])),_:1},8,["data"]),(0,_._)("div",$,[(0,_.Wm)(_e,{currentPage:K.value.page,"onUpdate:currentPage":g[8]||(g[8]=e=>K.value.page=e),"page-size":K.value.page_size,"onUpdate:page-size":g[9]||(g[9]=e=>K.value.page_size=e),"page-sizes":[10,20,30,40,50],small:a.value,disabled:l.value,background:b.value,layout:"total, sizes, prev, pager, next, jumper",total:E.value,"current-page":K.value.page,onSizeChange:G,onCurrentChange:J},null,8,["currentPage","page-size","small","disabled","background","total","current-page"])])])),_:1},8,["modelValue"])])],64)}}},L=l(3744);const Y=(0,L.Z)(B,[["__scopeId","data-v-542384e2"]]);var Z=Y}}]);
//# sourceMappingURL=579.66e4b803.js.map